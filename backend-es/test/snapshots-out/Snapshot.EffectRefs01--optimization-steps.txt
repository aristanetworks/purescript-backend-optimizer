Snapshot.EffectRefs01.add (Step 0; Original)
  (Data.Semiring.add Data.Semiring.semiringInt)
---------------
Snapshot.EffectRefs01.add (Step 1; Final)
  Data.Semiring.intAdd

===============

Snapshot.EffectRefs01.bind (Step 0; Original)
  (Control.Bind.bind Effect.bindEffect)
---------------
Snapshot.EffectRefs01.bind (Step 1; Final)
  Effect.bindE

===============

Snapshot.EffectRefs01.discard (Step 0; Original)
  ((Control.Bind.discard Control.Bind.discardUnit) Effect.bindEffect)
---------------
Snapshot.EffectRefs01.discard (Step 1; Final)
  Effect.bindE

===============

Snapshot.EffectRefs01.test1 (Step 0; Original)
  (Effect.Ref.new 42)
---------------
Snapshot.EffectRefs01.test1 (Step 1)
  -- Inline v0
  let v0 = 42;
  -- Inline v1
  let v1 = (# refNew v0 #);
  v1
---------------
Snapshot.EffectRefs01.test1 (Step 2; Final)
  (# refNew 42 #)

===============

Snapshot.EffectRefs01.test2 (Step 0; Original)
  (\g@v0 -> (Effect.Ref.new (g@v0 42)))
---------------
Snapshot.EffectRefs01.test2 (Step 1)
  (\g@v0 ->
    let v1 = (g@v0 42);
    -- Inline v2
    let v2 = (# refNew v1 #);
    v2
  )
---------------
Snapshot.EffectRefs01.test2 (Step 2; Final)
  (\g@v0 ->
    let v1 = (g@v0 42);
    (# refNew v1 #)
  )

===============

Snapshot.EffectRefs01.test3 (Step 0; Original)
  (\r@v0 -> (Effect.Ref.read r@v0))
---------------
Snapshot.EffectRefs01.test3 (Step 1; Final)
  (\r@v0 -> (# refRead r@v0 #))

===============

Snapshot.EffectRefs01.test4 (Step 0; Original)
  (\g@v0 -> \r@v1 -> (Effect.Ref.read (g@v0 r@v1)))
---------------
Snapshot.EffectRefs01.test4 (Step 1)
  (\g@v0 -> \r@v1 ->
    let v2 = (g@v0 r@v1);
    -- Inline v3
    let v3 = (# refRead v2 #);
    v3
  )
---------------
Snapshot.EffectRefs01.test4 (Step 2; Final)
  (\g@v0 -> \r@v1 ->
    let v2 = (g@v0 r@v1);
    (# refRead v2 #)
  )

===============

Snapshot.EffectRefs01.test5 (Step 0; Original)
  (\r@v0 -> ((Effect.Ref.write 42) r@v0))
---------------
Snapshot.EffectRefs01.test5 (Step 1)
  (\r@v0 ->
    -- Inline v1
    let v1 = 42;
    -- Inline v2
    let v2 = (# refWrite r@v0 v1 #);
    v2
  )
---------------
Snapshot.EffectRefs01.test5 (Step 2; Final)
  (\r@v0 -> (# refWrite r@v0 42 #))

===============

Snapshot.EffectRefs01.test6 (Step 0; Original)
  (\g@v0 -> \r@v1 -> ((Effect.Ref.write (g@v0 42)) r@v1))
---------------
Snapshot.EffectRefs01.test6 (Step 1)
  (\g@v0 -> \r@v1 ->
    let v2 = (g@v0 42);
    -- Inline v3
    let v3 = (# refWrite r@v1 v2 #);
    v3
  )
---------------
Snapshot.EffectRefs01.test6 (Step 2; Final)
  (\g@v0 -> \r@v1 ->
    let v2 = (g@v0 42);
    (# refWrite r@v1 v2 #)
  )

===============

Snapshot.EffectRefs01.test7 (Step 0; Original)
  (\g@v0 -> \r@v1 -> ((Effect.Ref.modify g@v0) r@v1))
---------------
Snapshot.EffectRefs01.test7 (Step 1; Final)
  (\g@v0 -> \r@v1 ->
    letEffect v2 = (# refRead r@v1 #);
    (# refWrite r@v1 (g@v0 v2) #)
  )

===============

Snapshot.EffectRefs01.test8 (Step 0; Original)
  (\g@v0 -> \r@v1 -> ((Effect.Ref.modify (g@v0 g@v0)) r@v1))
---------------
Snapshot.EffectRefs01.test8 (Step 1)
  (\g@v0 -> \r@v1 ->
    let v2 = (g@v0 g@v0);
    -- Inline v3
    let v3 =
      letEffect v3 = (# refRead r@v1 #);
      (# refWrite r@v1 (v2 v3) #);
    v3
  )
---------------
Snapshot.EffectRefs01.test8 (Step 2; Final)
  (\g@v0 -> \r@v1 ->
    let v2 = (g@v0 g@v0);
    letEffect v3 = (# refRead r@v1 #);
    (# refWrite r@v1 (v2 v3) #)
  )

===============

Snapshot.EffectRefs01.test9 (Step 0; Original)
  (\g@v0 ->
    (Snapshot.EffectRefs01.bind
      (Effect.Ref.new (g@v0 42))
      (\ref@v1 ->
        (Snapshot.EffectRefs01.bind
          (Effect.Ref.read ref@v1)
          (\prev@v2 ->
            (Snapshot.EffectRefs01.discard
              (Effect.Ref.write
                ((Snapshot.EffectRefs01.add prev@v2) 1)
                ref@v1
              )
              (\$__unused@v3 ->
                (Snapshot.EffectRefs01.bind
                  ((Effect.Ref.modify (Snapshot.EffectRefs01.add 1)) ref@v1)
                  (\$__unused@v4 -> (Effect.Ref.read ref@v1))
                )
              )
            )
          )
        )
      )
    )
  )
---------------
Snapshot.EffectRefs01.test9 (Step 1)
  (\g@v0 ->
    -- LetAssoc
    let v1 =
      let v1 = (g@v0 42);
      -- Inline v2
      let v2 = (# refNew v1 #);
      v2;
    -- Inline v2
    let v2 =
      letEffect ref@v2 = v1;
      -- Inline v3
      let v3 = (# refRead ref@v2 #);
      -- Inline v4
      let v4 =
        letEffect prev@v4 = v3;
        -- LetAssoc
        let v5 =
          let v5 =
            -- Inline v5
            let v5 = 1;
            ((add prev@v4) v5);
          -- Inline v6
          let v6 = (# refWrite ref@v2 v5 #);
          v6;
        -- Inline v6
        let v6 =
          letEffect $__unused@v6 = v5;
          -- LetAssoc
          let v7 =
            let v7 =
              -- Inline v7
              let v7 = 1;
              -- Inline v8
              let v8 = (\v8 -> ((add v7) v8));
              v8;
            -- Inline v8
            let v8 =
              letEffect v8 = (# refRead ref@v2 #);
              (# refWrite ref@v2 (v7 v8) #);
            v8;
          -- Inline v8
          let v8 =
            letEffect $__unused@v8 = v7;
            (# refRead ref@v2 #);
          v8;
        v6;
      v4;
    v2
  )
---------------
Snapshot.EffectRefs01.test9 (Step 2)
  (\g@v0 ->
    let v1 = (g@v0 42);
    -- Inline v2
    let v2 = (# refNew v1 #);
    letEffect ref@v3 = v2;
    letEffect prev@v4 = (# refRead ref@v3 #);
    let v5 = ((add prev@v4) 1);
    -- Inline v6
    let v6 = (# refWrite ref@v3 v5 #);
    letEffect $__unused@v7 = v6;
    -- Inline v8
    let v8 = (\v8 -> ((add 1) v8));
    -- Inline v9
    let v9 =
      letEffect v9 = (# refRead ref@v3 #);
      (# refWrite ref@v3 (v8 v9) #);
    letEffect $__unused@v10 = v9;
    (# refRead ref@v3 #)
  )
---------------
Snapshot.EffectRefs01.test9 (Step 3)
  (\g@v0 ->
    let v1 = (g@v0 42);
    letEffect ref@v2 = (# refNew v1 #);
    letEffect prev@v3 = (# refRead ref@v2 #);
    -- Inline v4
    let v4 = ((add prev@v3) 1);
    letEffect $__unused@v5 = (# refWrite ref@v2 v4 #);
    -- EffectBindAssoc
    let $__unused@v6 =
      letEffect v6 = (# refRead ref@v2 #);
      (# refWrite ref@v2 ((add 1) v6) #);
    (# refRead ref@v2 #)
  )
---------------
Snapshot.EffectRefs01.test9 (Step 4; Final)
  (\g@v0 ->
    let v1 = (g@v0 42);
    letEffect ref@v2 = (# refNew v1 #);
    letEffect prev@v3 = (# refRead ref@v2 #);
    letEffect $__unused@v4 = (# refWrite ref@v2 ((add prev@v3) 1) #);
    letEffect v5 = (# refRead ref@v2 #);
    letEffect $__unused@v6 = (# refWrite ref@v2 ((add 1) v5) #);
    (# refRead ref@v2 #)
  )